<Window
    x:Class="DocTransform.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:DocTransform.ViewModels"
    xmlns:converters="using:DocTransform.Converters" 
    mc:Ignorable="d"
    Title="Excel到Word数据映射工具">
    <Grid x:Name="RootGrid" AllowDrop="True">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid x:Name="AppTitleBar" Grid.Row="0" Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}" Height="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0" Spacing="12">
                <FontIcon Glyph="&#xE72F;" FontFamily="Segoe Fluent Icons" FontSize="16" VerticalAlignment="Center" />
                <TextBlock VerticalAlignment="Center" FontSize="14" Text="Excel到Word数据映射工具" />
            </StackPanel>
        </Grid>

        <Border x:Name="MainContentBorder" Grid.Row="1" Margin="16" 
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                BorderThickness="1" 
                CornerRadius="{ThemeResource ControlCornerRadius}" 
                Shadow="{ThemeResource CardRestShadow}"
                AllowDrop="True">
            <Grid AllowDrop="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,0,12" AllowDrop="True">
                    <StackPanel x:Name="MainContentStackPanel" Margin="16" Spacing="16" AllowDrop="True">
                        <Border Margin="0,0,0,0" CornerRadius="4"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource AccentControlBorderBrushActive}"
                                BorderThickness="1"
                                AllowDrop="True"
                                Padding="16,12">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                                <FontIcon Glyph="&#xE7AB;" 
                                          FontFamily="Segoe Fluent Icons" 
                                          FontSize="20" 
                                          VerticalAlignment="Center"
                                          Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"/>
                                <TextBlock Text="您可以将Excel文件或Word模板文件拖放到此窗口"
                                           VerticalAlignment="Center"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Style="{ThemeResource CardBorderStyle}">
                            <StackPanel Margin="16" Spacing="16">
                                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="文件选择" />

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock VerticalAlignment="Center">
                                        <Run Text="当前模式: "/>
                                        <Run Text="{x:Bind ViewModel.CurrentTableModeText, Mode=OneWay}" 
                                             FontWeight="Bold" 
                                             Foreground="{x:Bind ViewModel.CurrentTableModeForegroundBrush, Mode=OneWay}"/>
                                    </TextBlock>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                                        <TextBlock Text="多表格模式" VerticalAlignment="Center" ToolTipService.ToolTip="启用后可导入多个Excel表格并自动匹配数据" />
                                        <ToggleButton IsChecked="{x:Bind ViewModel.IsMultiTableMode, Mode=TwoWay}" />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0" 
                                            Background="{ThemeResource ControlFillColorInputActiveBrush}" 
                                            CornerRadius="{ThemeResource ControlCornerRadius}" 
                                            MinHeight="32" Padding="8,6">
                                        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                            <FontIcon Glyph="&#xE72F;" FontFamily="Segoe Fluent Icons" Foreground="#107C41" VerticalAlignment="Center"/>
                                            <TextBlock VerticalAlignment="Center"
                                                       Text="{x:Bind ViewModel.ExcelFilePathDisplayText, Mode=OneWay}"
                                                       TextTrimming="CharacterEllipsis" ToolTipService.ToolTip="{x:Bind ViewModel.ExcelFilePath, Mode=OneWay}"
                                                       Foreground="{x:Bind ViewModel.ExcelFilePathIsPlaceholder, Mode=OneWay, Converter={StaticResource BoolToColorConverter}, ConverterParameter='{ThemeResource TextFillColorSecondaryBrush};{ThemeResource TextFillColorPrimaryBrush}'}"
                                                       FontStyle="{x:Bind ViewModel.ExcelFilePathIsPlaceholder, Mode=OneWay, Converter={StaticResource BoolToFontStyleConverter}, ConverterParameter='Italic;Normal'}"/>
                                        </StackPanel>
                                    </Border>
                                    <Button Grid.Column="1" Command="{x:Bind ViewModel.BrowseExcelFileCommand}" Style="{ThemeResource AccentButtonStyle}">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE72F;" FontFamily="Segoe Fluent Icons"/>
                                            <TextBlock Text="{x:Bind ViewModel.ExcelButtonText, Mode=OneWay}" />
                                        </StackPanel>
                                    </Button>
                                </Grid>

                            </StackPanel>
                        </Border>

                        <Border Margin="0,0,0,0" 
                                CornerRadius="4"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource AccentControlBorderBrushActive}"
                                BorderThickness="1"
                                AllowDrop="True"
                                Padding="16,12">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                                <FontIcon Glyph="&#xE7AB;" 
                                          FontFamily="Segoe Fluent Icons" 
                                          FontSize="20" 
                                          VerticalAlignment="Center"
                                          Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"/>
                                <TextBlock Text="您可以将Excel文件或Word模板文件拖放到此窗口"
                                           VerticalAlignment="Center"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>

                        <Border Style="{ThemeResource CardBorderStyle}">
                            <StackPanel Margin="16" Spacing="16">
                                <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="文件选择" />

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock VerticalAlignment="Center">
                                        <Run Text="当前模式: "/>
                                        <Run Text="{x:Bind ViewModel.CurrentTableModeText, Mode=OneWay}" 
                                             FontWeight="Bold" 
                                             Foreground="{x:Bind ViewModel.IsMultiTableMode, Mode=OneWay, 
                                                                   Converter={StaticResource BoolToColorConverter}, 
                                                                   ConverterParameter='SystemAccentColorBrush;TextFillColorPrimaryBrush'}"/>
                                    </TextBlock>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                                        <TextBlock Text="多表格模式" VerticalAlignment="Center" ToolTipService.ToolTip="启用后可导入多个Excel表格并自动匹配数据" />
                                        <ToggleButton IsChecked="{x:Bind ViewModel.IsMultiTableMode, Mode=TwoWay}" />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0" 
                                            Background="{ThemeResource ControlFillColorInputActiveBrush}" 
                                            CornerRadius="{ThemeResource ControlCornerRadius}" 
                                            MinHeight="32" Padding="8,6">
                                        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                            <FontIcon Glyph="&#xE72F;" FontFamily="Segoe Fluent Icons" Foreground="#107C41" VerticalAlignment="Center"/>
                                            <TextBlock VerticalAlignment="Center"
                                                       Text="{x:Bind ViewModel.ExcelFilePathDisplayText, Mode=OneWay}"
                                                       TextTrimming="CharacterEllipsis" 
                                                       ToolTipService.ToolTip="{x:Bind ViewModel.ExcelFilePath, Mode=OneWay}"
                                                       Foreground="{x:Bind ViewModel.ExcelFilePathIsPlaceholder, Mode=OneWay, 
                                                                            Converter={StaticResource BoolToColorConverter}, 
                                                                            ConverterParameter='{ThemeResource TextFillColorSecondaryBrush};{ThemeResource TextFillColorPrimaryBrush}'}"
                                                       FontStyle="{x:Bind ViewModel.ExcelFilePathIsPlaceholder, Mode=OneWay, 
                                                                         Converter={StaticResource BoolToFontStyleConverter}, 
                                                                         ConverterParameter='Italic;Normal'}"/>
                                        </StackPanel>
                                    </Border>
                                    <Button Grid.Column="1" Command="{x:Bind ViewModel.BrowseExcelFileCommand}" Style="{ThemeResource AccentButtonStyle}">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE72F;" FontFamily="Segoe Fluent Icons"/>
                                            <TextBlock Text="{x:Bind ViewModel.ExcelButtonText, Mode=OneWay}" />
                                        </StackPanel>
                                    </Button>
                                </Grid>

                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>

                <Border Grid.Row="1" 
                        Background="{ThemeResource LayerFillColorDefaultBrush}" 
                        CornerRadius="0,0,7,7" BorderThickness="0,1,0,0" 
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                    <Grid x:Name="StatusBarGrid" Margin="16,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis" />

                        <Border Grid.Column="1" Margin="8,0,0,0"
                                Visibility="{x:Bind ViewModel.IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                            <TextBlock VerticalAlignment="Center">
                                <Run Text="{x:Bind ViewModel.ProcessedItems, Mode=OneWay}" />
                                <Run Text="/" />
                                <Run Text="{x:Bind ViewModel.TotalItems, Mode=OneWay}" />
                            </TextBlock>
                        </Border>

                        <Button Grid.Column="2" Margin="16,0,0,0"
                                Command="{x:Bind ViewModel.OpenOutputFolderCommand}"
                                IsEnabled="{x:Bind ViewModel.IsOutputFolderAvailable, Mode=OneWay}"
                                Style="{ThemeResource DefaultButtonStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8DA;" FontFamily="Segoe Fluent Icons" FontSize="16"/>
                                <TextBlock Text="打开输出文件夹" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>
                
            </Grid>
        </Border>

        <Border x:Name="BusyOverlay" Grid.RowSpan="2" Background="#80000000"
                Visibility="{x:Bind ViewModel.IsProcessingOverlayVisible, Mode=OneWay, FallbackValue=Collapsed}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12" Padding="32" Background="{ThemeResource SolidBackgroundFillColorBaseBrush}" CornerRadius="8" MinWidth="200">
                <ProgressRing IsActive="True" Width="48" Height="48"/>
                <TextBlock Text="正在处理，请稍后..." Style="{ThemeResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>